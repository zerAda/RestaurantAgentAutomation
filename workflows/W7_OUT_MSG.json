{
  "name": "W7 - OUT Messenger Sender",
  "active": false,
  "settings": {
    "executionTimeout": 300,
    "saveExecutionProgress": true,
    "saveManualExecutions": true
  },
  "nodes": [
    {
      "parameters": {},
      "id": "f6b6bb16-96d3-4da5-829b-6d078be46f44",
      "name": "IN - From CORE",
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1,
      "position": [
        -2400,
        0
      ]
    },
    {
      "parameters": {
        "language": "javascript",
        "jsCode": "// Input expected from CORE: {\n//   channel, restaurantId, userId, replyText, buttons:[{id,title}], actions, debug\n// }\nconst payload = $json;\n\nconst url = ($env.MSG_SEND_URL || '').toString();\nif (!url) {\n  return [{json: {sent:false, reason:'MSG_SEND_URL not set', payload} }];\n}\n\nconst token = ($env.MSG_API_TOKEN || '').toString();\n\n// Generic send format (adapt to your provider / Meta Cloud API).\nconst body = {\n  channel: 'messenger',\n  to: payload.userId,\n  restaurantId: payload.restaurantId,\n  text: payload.replyText || '',\n  buttons: Array.isArray(payload.buttons) ? payload.buttons : [],\n  attachments: Array.isArray(payload.attachments) ? payload.attachments : []\n};\n\nconst res = await $httpRequest({\n  method: 'POST',\n  url,\n  headers: token ? { Authorization: 'Bearer ' + token } : {},\n  body,\n  json: true,\n  timeout: 30000\n});\n\nreturn [{json: {sent:true, providerResponse: res, body} }];"
      },
      "id": "b7cc336b-19b0-4fdb-8396-7e4aa877e1cd",
      "name": "OUT - Send Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -2150,
        0
      ]
    }
  ],
  "connections": {
    "IN - From CORE": {
      "main": [
        [
          {
            "node": "OUT - Send Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  }
}